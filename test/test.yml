version: 2.1

orbs:
  aws-cli: circleci/aws-cli@0.1.1

jobs:
  build:
    executor: aws-cli/default
    docker:
      - image: hashicorp/terraform
    environment:
      - TF_PLUGIN_CACHE_DIR: .terraform.d/plugin-cache
    steps:
      - checkout
      - run:
          name:
          command: |
            export AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
            export AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - run:
          name: debug
          command: |
            printenv
      - run:
          name: Create Sample Terraform
          command: |
            mv test/backend.tf backend.tf
            mv test/main.tf main.tf
            mv test/provider.tf provider.tf
            mv test/variables.tf variables.tf
      - terraform/init
      - terraform/plan
      - terraform/apply:
          use-plan: false
